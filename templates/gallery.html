<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detection gallery — EcoRoad AI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg0: #06090a; --bg: #0a0f12; --card: #0d1114; --card2: #11161a;
      --border: rgba(255,255,255,.10); --border2: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92); --text-2: rgba(255,255,255,.75); --text-3: rgba(255,255,255,.55); --text-4: rgba(255,255,255,.42);
      --accent: #22c55e; --green: #22c55e; --teal: #06b6d4; --amber: #eab308; --red: #ef4444;
      --risk-high: #ef4444; --risk-medium: #eab308; --risk-low: #22c55e;
      --radius: 12px; --radius-lg: 16px; --font-head: 'Space Grotesk', system-ui, sans-serif; --font-body: 'DM Sans', system-ui, sans-serif;
      --bg-raised: #0f1316; --bg-float: var(--card2);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--font-body); background: linear-gradient(180deg, #020304 0%, #070a0f 50%, #020304 100%); color: var(--text); min-height: 100vh; -webkit-font-smoothing: antialiased; }
    body > * { position: relative; z-index: 1; }
    .wrap { max-width: 1400px; margin: 0 auto; padding: 24px 20px; }
    .nav {
      display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;
      padding: 16px 0 24px; border-bottom: 1px solid var(--border); margin-bottom: 24px;
    }
    .nav-left { display: flex; align-items: center; gap: 14px; text-decoration: none; color: inherit; }
    .logo-mark { width: 42px; height: 42px; border-radius: 12px; background: linear-gradient(135deg, var(--green), var(--teal)); color: #06090a; font-size: 20px; font-weight: 800; display: flex; align-items: center; justify-content: center; font-family: var(--font-head); }
    .brand h1 { font-family: var(--font-head); font-size: 20px; font-weight: 700; }
    .brand p { font-size: 12px; color: var(--text-3); margin-top: 2px; }
    .nav-pills { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .pill { font-size: 11px; font-weight: 600; padding: 6px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-float); color: var(--text-3); }
    .pill-active { color: var(--accent); border-color: var(--accent); background: rgba(34,197,94,.12); }
    .clear-btn { font-size: 11px; font-weight: 600; padding: 6px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-float); color: var(--text-3); cursor: pointer; }
    .clear-btn:hover { color: var(--red); }
    .gallery-head { font-family: var(--font-head); font-size: 24px; font-weight: 700; margin-bottom: 8px; }
    .gallery-p { font-size: 14px; color: var(--text-2); margin-bottom: 24px; }
    .gallery-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px;
    }
    .gallery-card {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg);
      overflow: hidden; box-shadow: 0 12px 32px rgba(0,0,0,.3);
    }
    .gallery-card .thumb-wrap {
      position: relative; background: #000; aspect-ratio: 16/9; overflow: hidden;
    }
    .gallery-card video { width: 100%; height: 100%; object-fit: contain; display: block; }
    .gallery-card .no-video { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: var(--text-4); font-size: 13px; }
    .gallery-card .caption {
      padding: 12px 14px; font-size: 13px;
    }
    .gallery-card .caption .name { font-weight: 600; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .gallery-card .caption .meta { margin-top: 6px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; font-size: 12px; color: var(--text-3); }
    .gallery-card .caption .risk { padding: 2px 8px; border-radius: 6px; font-weight: 600; font-size: 11px; }
    .gallery-card .caption .risk.risk-low { background: rgba(34,197,94,.2); color: var(--risk-low); }
    .gallery-card .caption .risk.risk-medium { background: rgba(234,179,8,.2); color: var(--risk-medium); }
    .gallery-card .caption .risk.risk-high { background: rgba(239,68,68,.2); color: var(--risk-high); }
    .gallery-card .caption a { color: var(--accent); text-decoration: none; font-weight: 600; }
    .gallery-card .caption a:hover { text-decoration: underline; }
    .gallery-empty { text-align: center; padding: 48px 24px; color: var(--text-3); font-size: 15px; }
    .gallery-empty a { color: var(--accent); text-decoration: none; font-weight: 600; }
    .gallery-empty a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav">
      <a href="/" class="nav-left" aria-label="Back to home">
        <div class="logo-mark">E</div>
        <div class="brand">
          <h1>Eco<b>Road</b> AI</h1>
          <p>Sustainable driving intelligence · SF Hacks 2026</p>
        </div>
      </a>
      <div class="nav-pills">
        <a href="/gallery" class="pill pill-active" style="text-decoration:none;color:inherit;">Gallery</a>
        <span class="pill">PyTorch</span>
        <span class="pill">YOLOv8</span>
        <form method="post" action="/clear" style="display:inline;" onsubmit="return confirm('Delete all uploads and annotated results?');">
          <button type="submit" class="clear-btn">Clear all</button>
        </form>
      </div>
    </nav>

    <h2 class="gallery-head">Detection gallery</h2>
    <p class="gallery-p">All runs with annotated video at once — see how object detection works on each clip.</p>

    {% if gallery_entries %}
    <div class="gallery-grid">
      {% for entry in gallery_entries %}
      <div class="gallery-card">
        <div class="thumb-wrap">
          {% if entry.video_available %}
          <video src="/annotated/{{ entry.output_id }}" controls playsinline preload="metadata" muted loop></video>
          {% else %}
          <div class="no-video">Video unavailable</div>
          {% endif %}
        </div>
        <div class="caption">
          <div class="name">{{ entry.filename }}</div>
          <div class="meta">
            {% if entry.eco_score is not none %}<span>Eco {{ entry.eco_score }}</span>{% endif %}
            {% if entry.risk_level %}<span class="risk risk-{{ entry.risk_level }}">{{ entry.risk_level }}</span>{% endif %}
            <span>{{ entry.timestamp[:10] }}{% if entry.timestamp|length > 10 %} {{ entry.timestamp[11:19] }}{% endif %}</span>
          </div>
          <a href="/?output_id={{ entry.output_id }}">View full results →</a>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="gallery-empty">
      <p>No analyses yet. <a href="/">Upload a video</a> to run detection, then come back to see all clips here.</p>
    </div>
    {% endif %}
  </div>
</body>
</html>
